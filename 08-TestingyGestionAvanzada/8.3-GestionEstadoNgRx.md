# Gesti√≥n de estado con NgRx
NgRx es una librer√≠a para Angular basada en el patr√≥n de dise√±o Redux, que se utiliza para gestionar el estado de las aplicaciones de manera predecible y eficiente. Redux organiza el estado de una aplicaci√≥n en un solo lugar, conocido como el store, lo que permite que todos los componentes tengan acceso al mismo estado y se actualicen de manera consistente.

NgRx no solo implementa este patr√≥n en Angular, sino que tambi√©n aprovecha la arquitectura reactiva del framework para integrar flujos de datos unidireccionales, asegurando que cada cambio en el estado sea trazable y controlado.

## ¬øPor qu√© necesitamos gestionar el estado?
En aplicaciones simples, el estado se puede manejar a trav√©s de propiedades o servicios. Sin embargo, en aplicaciones complejas, esto se vuelve problem√°tico por los siguientes motivos:
- Estado inconsistente: Los datos no se sincronizan entre los componentes.
- C√≥digo desordenado: La l√≥gica de estado se dispersa entre los componentes.
- Dificultad para depurar: Es complicado rastrear c√≥mo y cu√°ndo se cambi√≥ el estado.

NgRx resuelve estos problemas proporcionando una arquitectura clara y centralizada.

## Principios fundamentales de Redux y NgRx

| üìê **Principio**          | üìñ **Descripci√≥n**                                                                 |
|---------------------------|------------------------------------------------------------------------------------|
| Un solo store             | Todo el estado se almacena en un √∫nico objeto central.                            |
| Inmutabilidad             | El estado nunca se modifica directamente. Se crea una copia.                      |
| Flujo unidireccional      | Los datos fluyen en una direcci√≥n: Acci√≥n ‚Üí Reducer ‚Üí Store ‚Üí Componente.        |

## Componentes Principales de NgRx
- **Store**: 
    - El store es el contenedor de todo el estado de la aplicaci√≥n. 
    - Los componentes se suscriben al store para recibir actualizaciones autom√°ticas.
- **Actions** (Acciones)
    - Las acciones son objetos que describen eventos que ocurren en la aplicaci√≥n. 
    - Cada acci√≥n tiene una propiedad type que identifica el tipo de evento. 
    - Por ejemplo: `export const cargarUsuarios = createAction('[Usuarios] Cargar Usuarios');`
- **Reducers**
    - Los reducers definen c√≥mo cambia el estado en respuesta a una acci√≥n. 
    - Son funciones puras, lo que significa que no tienen efectos secundarios. 
    - Por ejemplo:
    ```ts
    export const usuarioReducer = createReducer(
        initialState,
        on(cargarUsuarios, (state, { usuarios }) => ({
            ...state,
            listaUsuarios: usuarios,
        }))
    );
    ```
- **Effects**
    - Los effects manejan operaciones as√≠ncronas (como llamadas a APIs) sin afectar la l√≥gica de los reducers. 
    - Por ejemplo:
    ```ts
    @Injectable()
    export class UsuarioEffects {
    cargarUsuarios$ = createEffect(() =>
        this.actions$.pipe(
        ofType(cargarUsuarios),
        mergeMap(() =>
            this.usuarioService.obtenerUsuarios().pipe(
            map((usuarios) => cargarUsuariosExitoso({ usuarios }))
            )
        )
        )
    );

    constructor(private actions$: Actions, private usuarioService: UsuarioService) {}
    }
    ```

## Beneficios de Usar NgRx
- **Escalabilidad**: Ideal para aplicaciones grandes y complejas.
- **Depuraci√≥n eficiente**: Permite rastrear cada cambio de estado con herramientas como Redux DevTools.
- **Flujo claro de datos**: Facilita la comprensi√≥n del flujo de informaci√≥n.
- **Reutilizaci√≥n de l√≥gica**: Las acciones y reducers pueden reutilizarse en m√∫ltiples partes de la app.

## Modelos del Store - Acciones, Reducer y Selectors
- **Acciones** (Actions)
    - Las acciones representan los eventos que desencadenan un cambio en el estado.
    - Caracter√≠sticas:
        - Identificador: La propiedad type permite identificar la acci√≥n.
        - Payload: Se puede adjuntar informaci√≥n adicional a la acci√≥n.
    - Ejemplo de acci√≥n: `export const incrementar = createAction('[Contador] Incrementar');`
- **Reducers**
    - Los reducers son funciones puras que actualizan el estado en funci√≥n de las acciones recibidas.
    - Caracter√≠sticas:
        - Sin efectos secundarios: No deben realizar llamadas a APIs ni modificar variables externas.
        - Inmutabilidad: Se crea un nuevo estado en lugar de modificar el existente.
    - Flujo de un Reducer:
        - La acci√≥n se despacha desde un componente.
        - El reducer recibe la acci√≥n y el estado actual.
        - El reducer actualiza el estado y devuelve uno nuevo.
    - Ejemplo de reducer:
    ```ts
    export const contadorReducer = createReducer(
        estadoInicial,
        on(incrementar, (state) => ({ contador: state.contador + 1 }))
    );
    ```
- **Selectores**
    - Los selectores permiten a los componentes acceder a partes espec√≠ficas del estado. Son funciones que extraen informaci√≥n de la tienda y la transforman si es necesario.
    - Caracter√≠sticas:
        - Acceso espec√≠fico: Extraen solo la parte del estado que el componente necesita.
        - Memoizaci√≥n: Se cachea el resultado para evitar c√°lculos innecesarios.
        - Composici√≥n: Se pueden combinar varios selectores.
    - Tipos de Selectores:
        - Selectores Simples: Acceden a una parte espec√≠fica del estado.
        - Selectores Compuestos: Combinan varios selectores para obtener datos m√°s complejos.
        - Selectores Memoizados: Evitan recalcular el valor si el estado no ha cambiado.
    - Ejemplo de selector simple: `export const selectContador = (state: AppState) => state.contador`
    - Ejemplo de selector memoizado:
    ```ts
    import { createSelector } from '@ngrx/store';

    export const selectContadorDoble = createSelector(
        selectContador,
        (contador) => contador * 2
    );
    ```

## Relaci√≥n entre Acciones, Reducers y Selectors
Los tres elementos se relacionan para formar el flujo completo de la gesti√≥n de estado. Este flujo se puede resumir de la siguiente forma:
- **Acci√≥n**: Un evento es despachado desde el componente.
- **Reducer**: La acci√≥n llega al reducer, donde se aplica la l√≥gica correspondiente para cambiar el estado.
- **Store**: El estado actualizado se almacena en el store global.
- **Selector**: Los componentes utilizan selectores para acceder a la parte espec√≠fica del estado que necesitan. 
Esta relaci√≥n garantiza que el flujo de datos sea unidireccional y predecible, lo que facilita la depuraci√≥n y el control del estado de la aplicaci√≥n